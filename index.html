<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç‹—è¿·å®« - å„¿ç«¥è¿·å®«æ¸¸æˆ</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    touch-action: manipulation; /* Disable double-tap zoom on Safari */
}

body {
    font-family: 'Arial', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 22px; /* 10% increase from 20px */
}

.game-container {
    background: white;
    border-radius: 22px; /* 10% increase from 20px */
    padding: 33px; /* 10% increase from 30px */
    box-shadow: 0 11px 44px rgba(0, 0, 0, 0.3); /* 10% increase */
    text-align: center;
    max-width: min(550px, 95vw); /* 10% increase from 500px, with screen limit */
    width: 100%;
}

h1 {
    color: #333;
    margin-bottom: 22px; /* 10% increase from 20px */
    font-size: 1.98rem; /* 10% increase from 1.8rem */
}

.maze-selector {
    margin-bottom: 22px; /* 10% increase from 20px */
}

.maze-selector label {
    font-size: 1.1rem; /* 10% increase from 1rem */
    color: #555;
    margin-right: 11px; /* 10% increase from 10px */
}

.maze-selector select {
    padding: 8.8px 16.5px; /* 10% increase */
    font-size: 1.1rem; /* 10% increase from 1rem */
    border: 2.2px solid #667eea; /* 10% increase */
    border-radius: 8.8px; /* 10% increase */
    background: white;
    cursor: pointer;
}

.stats-display {
    margin-bottom: 15px;
    padding: 11px; /* 10% increase from 10px */
    background: #f8f9fa;
    border-radius: 8.8px; /* 10% increase */
    display: flex;
    justify-content: center;
    gap: 22px; /* 10% increase from 20px */
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 5.5px; /* 10% increase from 5px */
    font-size: 1.1rem; /* 10% increase from 1rem */
    color: #555;
}

.stat-item .stat-value {
    font-weight: bold;
    color: #667eea;
}

.maze-grid {
    display: grid;
    gap: 5.5px; /* 10% increase from 5px */
    margin: 22px auto; /* 10% increase from 20px */
    max-width: min(352px, 90vw); /* 10% increase from 320px, with screen limit */
    background: #ddd;
    padding: 11px; /* 10% increase from 10px */
    border-radius: 11px; /* 10% increase from 10px */
}

.maze-grid.grid-5x5 {
    grid-template-columns: repeat(5, 1fr);
}

.maze-grid.grid-6x6 {
    grid-template-columns: repeat(6, 1fr);
}

.maze-grid.grid-7x7 {
    grid-template-columns: repeat(7, 1fr);
}

.cell {
    aspect-ratio: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2.2rem; /* 10% increase from 2rem */
    border-radius: 8.8px; /* 10% increase from 8px */
    background: #f0f0f0;
    transition: transform 0.2s;
}

.cell.wall {
    background: #333;
}

.cell.path {
    background: #90EE90;
}

.cell.dog {
    background: #FF6347;
    animation: bounce 0.5s infinite alternate;
    box-shadow: 0 0 10px rgba(255, 99, 71, 0.8);
}

.cell.prize {
    background: #FF69B4;
}

@keyframes bounce {
    from { transform: scale(1); }
    to { transform: scale(1.1); }
}

.controls {
    margin-top: 22px; /* 10% increase from 20px */
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5.5px; /* 10% increase from 5px */
}

.horizontal-controls {
    display: flex;
    gap: 5.5px; /* 10% increase from 5px */
}

.control-btn {
    width: 66px; /* 10% increase from 60px */
    height: 66px; /* 10% increase from 60px */
    font-size: 1.65rem; /* 10% increase from 1.5rem */
    border: none;
    border-radius: 11px; /* 10% increase from 10px */
    background: #667eea;
    color: white;
    cursor: pointer;
    transition: transform 0.1s, background 0.2s;
}

.control-btn:hover {
    background: #5a6fd6;
}

.control-btn:active {
    transform: scale(0.95);
}

.instructions {
    margin-top: 16.5px; /* 10% increase from 15px */
    color: #666;
    font-size: 0.99rem; /* 10% increase from 0.9rem */
}

.dialog {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100;
}

.dialog.hidden {
    display: none;
}

.dialog-content {
    background: white;
    padding: 44px; /* 10% increase from 40px */
    border-radius: 22px; /* 10% increase from 20px */
    text-align: center;
    animation: pop 0.3s ease-out;
}

@keyframes pop {
    from { transform: scale(0.5); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.dialog-content h2 {
    color: #667eea;
    font-size: 2.2rem; /* 10% increase from 2rem */
    margin-bottom: 16.5px; /* 10% increase from 15px */
}

.dialog-content p {
    color: #555;
    margin-bottom: 22px; /* 10% increase from 20px */
    font-size: 1.21rem; /* 10% increase from 1.1rem */
}

.dialog-content .stats-info {
    color: #667eea;
    font-weight: bold;
    margin-bottom: 16.5px; /* 10% increase from 15px */
    font-size: 1.21rem; /* 10% increase from 1.1rem */
}

.dialog-content .auto-close-hint {
    color: #999;
    font-size: 0.88rem;
    margin-top: 11px; /* 10% increase from 10px */
}

.dialog-content button {
    padding: 13.2px 33px; /* 10% increase from 12px 30px */
    font-size: 1.21rem; /* 10% increase from 1.1rem */
    border: none;
    border-radius: 11px; /* 10% increase from 10px */
    background: #667eea;
    color: white;
    cursor: pointer;
    transition: background 0.2s;
}

.dialog-content button:hover {
    background: #5a6fd6;
}

/* Responsive Design for Mobile */
@media (max-width: 480px) {
    .game-container {
        padding: 16.5px; /* 10% increase from 15px */
    }
    
    h1 {
        font-size: 1.54rem; /* 10% increase from 1.4rem */
    }
    
    .maze-grid {
        max-width: min(308px, 90vw); /* 10% increase from 280px, with screen limit */
    }
    
    .cell {
        font-size: 1.65rem; /* 10% increase from 1.5rem */
    }
    
    .control-btn {
        width: 55px; /* 10% increase from 50px */
        height: 55px; /* 10% increase from 50px */
        font-size: 1.32rem; /* 10% increase from 1.2rem */
    }
    
    .stats-display {
        flex-direction: column;
        gap: 5.5px; /* 10% increase from 5px */
    }
}

/* Tablet styles */
@media (min-width: 481px) and (max-width: 768px) {
    .maze-grid {
        max-width: min(385px, 90vw); /* 10% increase from 350px, with screen limit */
    }
}
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ• å°ç‹—æ‰¾å¥–å“ ğŸ†</h1>
        <div class="maze-selector">
            <label for="maze-select">é€‰æ‹©è¿·å®«ï¼š</label>
            <select id="maze-select"></select>
        </div>
        <div class="stats-display">
            <div class="stat-item">
                <span>â±ï¸ ç”¨æ—¶ï¼š</span>
                <span class="stat-value" id="elapsed-time">0ç§’</span>
            </div>
            <div class="stat-item">
                <span>ğŸ‘£ æ­¥æ•°ï¼š</span>
                <span class="stat-value" id="step-count">0</span>
            </div>
        </div>
        <div id="maze-grid" class="maze-grid"></div>
        <div class="controls">
            <button class="control-btn" id="btn-up">â¬†ï¸</button>
            <div class="horizontal-controls">
                <button class="control-btn" id="btn-left">â¬…ï¸</button>
                <button class="control-btn" id="btn-down">â¬‡ï¸</button>
                <button class="control-btn" id="btn-right">â¡ï¸</button>
            </div>
        </div>
        <p class="instructions">ç”¨æ–¹å‘é”®æˆ–ç‚¹å‡»æŒ‰é’®ç§»åŠ¨å°ç‹—åˆ°å¥–å“å¤„ï¼</p>
    </div>
    <div id="win-dialog" class="dialog hidden">
        <div class="dialog-content">
            <h2>ğŸ‰ å¤ªæ£’äº†ï¼ğŸ‰</h2>
            <p id="win-message">ä½ çœŸèªæ˜ï¼æˆåŠŸå¸®å°ç‹—æ‰¾åˆ°äº†å¥–å“ï¼</p>
            <p class="stats-info" id="win-stats"></p>
            <button id="play-again">å†ç©ä¸€æ¬¡</button>
            <p class="auto-close-hint">5ç§’åè‡ªåŠ¨å…³é—­ æˆ–æŒ‰ ENTER é”®å…³é—­</p>
        </div>
    </div>
    <script>
// 30 predefined mazes for the game
// 0 = path, 1 = wall, 2 = dog (start), 3 = prize (end)
// Levels 1-10: 5x5 (original easy difficulty)
// Levels 11-20: 6x6 (harder difficulty)
// Levels 21-30: 7x7 (hell difficulty)

const mazes = [
    // Maze 1 - Very Easy (5x5)
    [
        [2, 0, 0, 0, 3],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
    ],
    // Maze 2 - Easy (5x5)
    [
        [2, 0, 1, 0, 0],
        [0, 0, 1, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 1, 0, 0],
        [0, 0, 1, 0, 3]
    ],
    // Maze 3 (5x5)
    [
        [2, 0, 0, 0, 0],
        [1, 1, 1, 1, 0],
        [0, 0, 0, 0, 0],
        [0, 1, 1, 1, 1],
        [0, 0, 0, 0, 3]
    ],
    // Maze 4 (5x5)
    [
        [2, 0, 0, 1, 0],
        [0, 1, 0, 1, 0],
        [0, 1, 0, 0, 0],
        [0, 1, 1, 1, 0],
        [0, 0, 0, 0, 3]
    ],
    // Maze 5 (5x5)
    [
        [0, 0, 2, 0, 0],
        [0, 1, 1, 1, 0],
        [0, 0, 0, 0, 0],
        [0, 1, 1, 1, 0],
        [0, 0, 3, 0, 0]
    ],
    // Maze 6 (5x5)
    [
        [2, 1, 0, 0, 0],
        [0, 1, 0, 1, 0],
        [0, 0, 0, 1, 0],
        [0, 1, 1, 1, 0],
        [0, 0, 0, 0, 3]
    ],
    // Maze 7 (5x5)
    [
        [2, 0, 0, 0, 0],
        [1, 1, 1, 0, 1],
        [0, 0, 0, 0, 0],
        [1, 0, 1, 1, 1],
        [3, 0, 0, 0, 0]
    ],
    // Maze 8 (5x5)
    [
        [0, 0, 2, 0, 0],
        [0, 1, 0, 1, 0],
        [0, 0, 0, 0, 0],
        [0, 1, 0, 1, 0],
        [0, 0, 3, 0, 0]
    ],
    // Maze 9 (5x5)
    [
        [2, 0, 1, 0, 3],
        [0, 0, 1, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 1, 0, 0],
        [0, 0, 1, 0, 0]
    ],
    // Maze 10 (5x5)
    [
        [2, 0, 0, 0, 0],
        [0, 1, 1, 1, 0],
        [0, 1, 3, 1, 0],
        [0, 1, 0, 1, 0],
        [0, 0, 0, 0, 0]
    ],
    // Maze 11 - 6x6 Harder difficulty
    [
        [2, 0, 1, 0, 0, 0],
        [0, 0, 1, 0, 1, 0],
        [1, 0, 0, 0, 1, 0],
        [1, 1, 1, 0, 0, 0],
        [0, 0, 0, 0, 1, 0],
        [0, 1, 1, 0, 0, 3]
    ],
    // Maze 12 - 6x6 Harder
    [
        [0, 0, 0, 1, 0, 2],
        [0, 1, 0, 1, 0, 0],
        [0, 1, 0, 0, 0, 1],
        [0, 0, 0, 1, 0, 0],
        [1, 1, 0, 1, 1, 0],
        [3, 0, 0, 0, 0, 0]
    ],
    // Maze 13 - 6x6 Harder
    [
        [2, 0, 0, 0, 1, 0],
        [1, 1, 1, 0, 1, 0],
        [0, 0, 0, 0, 0, 0],
        [0, 1, 1, 1, 1, 0],
        [0, 0, 0, 0, 0, 0],
        [0, 1, 1, 1, 0, 3]
    ],
    // Maze 14 - 6x6 Harder
    [
        [0, 0, 2, 0, 0, 0],
        [0, 1, 1, 1, 1, 0],
        [0, 0, 0, 0, 0, 0],
        [1, 1, 0, 1, 1, 0],
        [0, 0, 0, 0, 0, 0],
        [0, 1, 1, 1, 0, 3]
    ],
    // Maze 15 - 6x6 Harder
    [
        [2, 1, 0, 0, 1, 0],
        [0, 0, 0, 1, 0, 0],
        [0, 1, 0, 0, 0, 1],
        [0, 1, 1, 1, 0, 0],
        [0, 0, 0, 1, 1, 0],
        [1, 1, 0, 0, 0, 3]
    ],
    // Maze 16 - 6x6 Harder
    [
        [0, 1, 0, 0, 0, 2],
        [0, 1, 0, 1, 0, 0],
        [0, 0, 0, 1, 1, 0],
        [1, 1, 0, 0, 0, 0],
        [0, 0, 0, 1, 1, 0],
        [3, 1, 0, 0, 0, 0]
    ],
    // Maze 17 - 6x6 Harder
    [
        [2, 0, 1, 0, 0, 0],
        [0, 0, 1, 0, 1, 0],
        [0, 0, 0, 0, 1, 0],
        [1, 1, 1, 0, 0, 0],
        [0, 0, 0, 0, 1, 1],
        [0, 1, 1, 0, 0, 3]
    ],
    // Maze 18 - 6x6 Harder
    [
        [3, 0, 0, 1, 0, 0],
        [1, 1, 0, 1, 0, 1],
        [0, 0, 0, 0, 0, 0],
        [0, 1, 1, 1, 0, 0],
        [0, 0, 0, 0, 0, 1],
        [0, 1, 1, 1, 0, 2]
    ],
    // Maze 19 - 6x6 Harder
    [
        [2, 0, 0, 1, 0, 0],
        [1, 1, 0, 0, 0, 1],
        [0, 0, 0, 1, 0, 0],
        [0, 1, 0, 1, 1, 0],
        [0, 1, 0, 0, 0, 0],
        [0, 0, 0, 1, 0, 3]
    ],
    // Maze 20 - 6x6 Harder
    [
        [0, 0, 0, 1, 0, 2],
        [0, 1, 0, 1, 0, 0],
        [0, 1, 0, 0, 0, 1],
        [0, 0, 0, 1, 0, 0],
        [1, 1, 0, 1, 0, 1],
        [3, 0, 0, 0, 0, 0]
    ],
    // Maze 21 - 7x7 Hell difficulty
    [
        [2, 0, 1, 0, 0, 1, 0],
        [0, 0, 1, 0, 0, 1, 0],
        [1, 0, 0, 0, 1, 0, 0],
        [0, 0, 1, 0, 0, 0, 1],
        [0, 1, 1, 1, 1, 0, 0],
        [0, 0, 0, 0, 1, 0, 1],
        [1, 1, 1, 0, 0, 0, 3]
    ],
    // Maze 22 - 7x7 Hell
    [
        [0, 0, 0, 1, 0, 0, 2],
        [0, 1, 0, 1, 0, 1, 0],
        [0, 1, 0, 0, 0, 1, 0],
        [0, 0, 0, 1, 0, 0, 0],
        [1, 1, 0, 1, 1, 1, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [3, 1, 1, 1, 1, 1, 0]
    ],
    // Maze 23 - 7x7 Hell
    [
        [2, 0, 0, 1, 0, 0, 0],
        [1, 1, 0, 1, 0, 1, 0],
        [0, 0, 0, 0, 0, 1, 0],
        [0, 1, 1, 1, 0, 0, 0],
        [0, 0, 0, 1, 0, 1, 1],
        [1, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 1, 1, 1, 3]
    ],
    // Maze 24 - 7x7 Hell
    [
        [0, 0, 1, 0, 0, 0, 2],
        [0, 0, 1, 0, 1, 0, 0],
        [1, 0, 0, 0, 1, 1, 0],
        [0, 0, 1, 0, 0, 0, 0],
        [0, 1, 1, 1, 1, 1, 0],
        [0, 0, 0, 0, 0, 1, 0],
        [3, 1, 1, 1, 0, 0, 0]
    ],
    // Maze 25 - 7x7 Hell
    [
        [2, 0, 0, 0, 1, 0, 0],
        [1, 1, 1, 0, 1, 0, 1],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 1, 0, 1, 1, 1, 0],
        [0, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 1, 1, 1, 0],
        [0, 1, 0, 0, 0, 0, 3]
    ],
    // Maze 26 - 7x7 Hell
    [
        [0, 1, 0, 0, 1, 0, 2],
        [0, 1, 0, 0, 1, 0, 0],
        [0, 0, 0, 1, 0, 0, 1],
        [1, 1, 0, 1, 0, 1, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 1, 1, 1, 1, 0, 1],
        [3, 0, 0, 0, 0, 0, 0]
    ],
    // Maze 27 - 7x7 Hell
    [
        [2, 0, 1, 0, 0, 0, 0],
        [0, 0, 1, 0, 1, 1, 0],
        [1, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 1, 1, 0],
        [0, 1, 0, 0, 0, 0, 0],
        [0, 1, 0, 1, 1, 1, 0],
        [0, 0, 0, 0, 0, 0, 3]
    ],
    // Maze 28 - 7x7 Hell
    [
        [0, 0, 0, 1, 0, 0, 2],
        [0, 1, 0, 1, 0, 1, 0],
        [0, 1, 0, 0, 0, 1, 0],
        [0, 0, 0, 1, 0, 0, 0],
        [1, 1, 0, 1, 0, 1, 1],
        [0, 0, 0, 0, 0, 0, 0],
        [3, 1, 1, 0, 1, 1, 0]
    ],
    // Maze 29 - 7x7 Hell
    [
        [2, 0, 0, 1, 0, 1, 3],
        [0, 1, 0, 1, 0, 1, 0],
        [0, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 1, 1, 1, 0],
        [1, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 1, 1, 1, 0],
        [0, 1, 0, 0, 0, 0, 0]
    ],
    // Maze 30 - 7x7 Hell (Ultimate)
    [
        [0, 0, 0, 1, 0, 0, 0],
        [0, 1, 0, 1, 0, 1, 0],
        [0, 1, 0, 0, 0, 1, 0],
        [0, 0, 0, 1, 0, 0, 0],
        [1, 1, 0, 1, 0, 1, 1],
        [0, 0, 0, 1, 0, 0, 0],
        [2, 1, 0, 0, 0, 1, 3]
    ]
];

// Encouraging messages in Chinese
const encourageMessages = [
    "å¤ªæ£’äº†ï¼ä½ çœŸæ˜¯ä¸ªèªæ˜çš„å°æœ‹å‹ï¼",
    "å“‡ï¼ä½ æˆåŠŸäº†ï¼ä½ çœŸå‰å®³ï¼",
    "çœŸæ£’ï¼å°ç‹—å¾ˆé«˜å…´æ‰¾åˆ°äº†å¥–å“ï¼",
    "ä½ å¤ªèªæ˜äº†ï¼ç»§ç»­åŠ æ²¹ï¼",
    "å¥½å‰å®³ï¼ä½ æ˜¯è¿·å®«å°é«˜æ‰‹ï¼",
    "æˆåŠŸå•¦ï¼ä½ çœŸæ˜¯å¤ªä¼˜ç§€äº†ï¼",
    "æ­å–œä½ ï¼å°ç‹—éå¸¸å¼€å¿ƒï¼",
    "ä½ åšåˆ°äº†ï¼çœŸäº†ä¸èµ·ï¼"
];

let currentMaze = 0;
let dogPosition = { row: 0, col: 0 };
let prizePosition = { row: 0, col: 0 };
let gameGrid = [];
let stepCount = 0;
let startTime = null;
let timerInterval = null;
let dialogAutoCloseTimer = null;

// Get maze size based on level
function getMazeSize(mazeIndex) {
    if (mazeIndex < 10) return 5;  // Levels 1-10: 5x5
    if (mazeIndex < 20) return 6;  // Levels 11-20: 6x6
    return 7;  // Levels 21-30: 7x7
}

// Initialize the game
function init() {
    populateMazeSelector();
    loadMaze(currentMaze);
    setupControls();
}

// Populate the maze selector dropdown
function populateMazeSelector() {
    const select = document.getElementById('maze-select');
    for (let i = 0; i < mazes.length; i++) {
        const option = document.createElement('option');
        option.value = i;
        let difficulty = '';
        if (i < 10) difficulty = 'ç®€å•';
        else if (i < 20) difficulty = 'å›°éš¾';
        else difficulty = 'åœ°ç‹±';
        option.textContent = `è¿·å®« ${i + 1} (${difficulty})`;
        select.appendChild(option);
    }
    select.addEventListener('change', (e) => {
        currentMaze = parseInt(e.target.value);
        loadMaze(currentMaze);
    });
}

// Load a specific maze
function loadMaze(mazeIndex) {
    // Reset stats
    stepCount = 0;
    startTime = Date.now();
    updateStatsDisplay();
    
    // Start timer
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(updateStatsDisplay, 1000);
    
    // Deep copy the maze
    gameGrid = mazes[mazeIndex].map(row => [...row]);
    
    const size = getMazeSize(mazeIndex);
    
    // Find dog and prize positions
    for (let row = 0; row < size; row++) {
        for (let col = 0; col < size; col++) {
            if (gameGrid[row][col] === 2) {
                dogPosition = { row, col };
            } else if (gameGrid[row][col] === 3) {
                prizePosition = { row, col };
            }
        }
    }
    
    renderMaze();
}

// Update stats display
function updateStatsDisplay() {
    const elapsedSeconds = startTime ? Math.floor((Date.now() - startTime) / 1000) : 0;
    document.getElementById('elapsed-time').textContent = `${elapsedSeconds}ç§’`;
    document.getElementById('step-count').textContent = stepCount;
}

// Render the maze grid
function renderMaze() {
    const mazeElement = document.getElementById('maze-grid');
    const size = getMazeSize(currentMaze);
    
    // Update grid class
    mazeElement.className = `maze-grid grid-${size}x${size}`;
    mazeElement.innerHTML = '';
    
    for (let row = 0; row < size; row++) {
        for (let col = 0; col < size; col++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            
            const value = gameGrid[row][col];
            if (value === 1) {
                cell.classList.add('wall');
                cell.textContent = 'ğŸ§±';
            } else if (value === 2) {
                cell.classList.add('dog');
                cell.textContent = 'ğŸ•';
            } else if (value === 3) {
                cell.classList.add('prize');
                cell.textContent = 'ğŸ†';
            } else {
                cell.classList.add('path');
            }
            
            mazeElement.appendChild(cell);
        }
    }
}

// Setup game controls
function setupControls() {
    // Button controls
    document.getElementById('btn-up').addEventListener('click', () => moveDog(-1, 0));
    document.getElementById('btn-down').addEventListener('click', () => moveDog(1, 0));
    document.getElementById('btn-left').addEventListener('click', () => moveDog(0, -1));
    document.getElementById('btn-right').addEventListener('click', () => moveDog(0, 1));
    
    // Keyboard controls
    document.addEventListener('keydown', (e) => {
        const dialog = document.getElementById('win-dialog');
        const isDialogOpen = !dialog.classList.contains('hidden');
        
        // Handle Enter key to close dialog
        if (e.key === 'Enter' && isDialogOpen) {
            e.preventDefault();
            closeDialogAndNextLevel();
            return;
        }
        
        // Don't allow movement when dialog is open
        if (isDialogOpen) return;
        
        switch(e.key) {
            case 'ArrowUp':
                e.preventDefault();
                moveDog(-1, 0);
                break;
            case 'ArrowDown':
                e.preventDefault();
                moveDog(1, 0);
                break;
            case 'ArrowLeft':
                e.preventDefault();
                moveDog(0, -1);
                break;
            case 'ArrowRight':
                e.preventDefault();
                moveDog(0, 1);
                break;
        }
    });
    
    // Play again button
    document.getElementById('play-again').addEventListener('click', () => {
        closeDialogAndNextLevel();
    });
}

// Close dialog and go to next level
function closeDialogAndNextLevel() {
    // Clear auto-close timer
    if (dialogAutoCloseTimer) {
        clearTimeout(dialogAutoCloseTimer);
        dialogAutoCloseTimer = null;
    }
    
    document.getElementById('win-dialog').classList.add('hidden');
    // Go to next maze or loop back to first
    currentMaze = (currentMaze + 1) % mazes.length;
    document.getElementById('maze-select').value = currentMaze;
    loadMaze(currentMaze);
}

// Move the dog
function moveDog(rowDelta, colDelta) {
    const size = getMazeSize(currentMaze);
    const newRow = dogPosition.row + rowDelta;
    const newCol = dogPosition.col + colDelta;
    
    // Check boundaries
    if (newRow < 0 || newRow >= size || newCol < 0 || newCol >= size) {
        return;
    }
    
    // Check for wall
    if (gameGrid[newRow][newCol] === 1) {
        return;
    }
    
    // Move the dog
    gameGrid[dogPosition.row][dogPosition.col] = 0;
    dogPosition.row = newRow;
    dogPosition.col = newCol;
    stepCount++;
    updateStatsDisplay();
    
    // Check for win condition
    if (newRow === prizePosition.row && newCol === prizePosition.col) {
        gameGrid[newRow][newCol] = 2;
        renderMaze();
        // Stop timer
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
        }
        showWinDialog();
        return;
    }
    
    gameGrid[newRow][newCol] = 2;
    renderMaze();
}

// Show the winning dialog
function showWinDialog() {
    const dialog = document.getElementById('win-dialog');
    const message = document.getElementById('win-message');
    const statsInfo = document.getElementById('win-stats');
    
    // Select a random encouraging message
    const randomMessage = encourageMessages[Math.floor(Math.random() * encourageMessages.length)];
    message.textContent = randomMessage;
    
    // Show stats
    const elapsedSeconds = startTime ? Math.floor((Date.now() - startTime) / 1000) : 0;
    statsInfo.textContent = `ç”¨æ—¶ï¼š${elapsedSeconds}ç§’ | æ­¥æ•°ï¼š${stepCount}æ­¥`;
    
    dialog.classList.remove('hidden');
    
    // Auto-close after 5 seconds
    dialogAutoCloseTimer = setTimeout(() => {
        if (!dialog.classList.contains('hidden')) {
            closeDialogAndNextLevel();
        }
    }, 5000);
}

// Start the game when DOM is loaded
document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
